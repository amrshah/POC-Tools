<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Strategy Consultant</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                },
            },
        }
    </script>
    <style>
        /* Custom scrollbar for better look */
        #response-output::-webkit-scrollbar { width: 8px; }
        #response-output::-webkit-scrollbar-thumb { background-color: #6366f1; border-radius: 4px; }
        #response-output::-webkit-scrollbar-track { background-color: #f1f1f1; }
        .cta-get-this-tool{
            text-align: center;
            font-size: 16px;
            font-weight: 600;
            color: #f1637b;
            margin-bottom: 12px;}
    </style>
</head>
<body class="bg-gray-50 flex items-center justify-center min-h-screen p-4 font-sans">
    
    <div class="w-full max-w-2xl bg-white shadow-2xl rounded-xl p-8 space-y-6">
        
        <h1 class="text-3xl font-bold text-center text-indigo-700">
             Strategy AI: Local Business Consultant
        </h1>
        <p class="text-center text-sm text-gray-500">
            Ask for a strategy. Our Business AI Expert will respond by delivering structured, actionable recommendations.
        </p>
        
        <div class="space-y-4">
            <label for="business-input" class="block text-sm font-medium text-gray-700">1. Your Business Type (e.g., Laptop Repairs):</label>
            <input type="text" id="business-input" value="Laptop Repairs"
                class="w-full p-3 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 transition duration-150 ease-in-out">
            
            <label for="goal-input" class="block text-sm font-medium text-gray-700">2. Your Immediate Goal (e.g., I need a website):</label>
            <textarea id="goal-input" rows="2"
                class="w-full p-3 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 transition duration-150 ease-in-out resize-none">I need a website for my laptop repair business</textarea>

            <button id="submit-button"
                class="w-full px-6 py-3 bg-indigo-600 text-white font-semibold rounded-lg shadow-md hover:bg-indigo-700 focus:outline-none focus:ring-4 focus:ring-indigo-500 focus:ring-opacity-50 transition duration-150 ease-in-out disabled:opacity-50"
                onclick="generateStrategy()">
                Get Expert Strategy
            </button>
        </div>

        <div class="relative pt-6">
            <h2 class="text-xl font-semibold text-gray-700 mb-3 border-b pb-2">Top Recommendations</h2>
            <div id="loading-indicator" class="text-center hidden text-indigo-500 font-medium py-4">
                 Strategy AI is analyzing the market...
            </div>
            <div id="response-output" 
                class="min-h-[150px] bg-white text-gray-800">
                Enter your business details and goal above to receive a tailored 3-point strategy.
            </div>
        </div>
        <div class="cta-get-this-tool">
            Get this tool for your website for <strong>$3 a month</strong>!
        </div>
    </div>

    <script>
        // our deployed Cloudflare Worker endpoint!
        const API_PROXY_URL = "https://gemini-api-keys.amr-shah.workers.dev"; 
        
        const businessInput = document.getElementById('business-input');
        const goalInput = document.getElementById('goal-input');
        const responseOutput = document.getElementById('response-output');
        const loadingIndicator = document.getElementById('loading-indicator');
        const submitButton = document.getElementById('submit-button');

        // handle the JSON response from the worker/Gemini API
        function renderRecommendations(recommendations) {
            let html = '<div class="space-y-6">';
            
            recommendations.sort((a, b) => a.rank - b.rank); // Sort by rank/priority
            
            recommendations.forEach(item => {
                html += `
                    <div class="p-4 bg-white border border-indigo-200 rounded-lg shadow-md">
                        <div class="flex items-center space-x-3">
                            <span class="text-3xl font-extrabold text-indigo-600">${item.rank}.</span>
                            <h3 class="text-xl font-bold text-gray-900">${item.title}</h3>
                        </div>
                        <p class="mt-2 text-gray-600 pl-8 border-l-4 border-indigo-400">
                            ${item.rationale}
                        </p>
                    </div>
                `;
            });
            
            html += '</div>';
            responseOutput.innerHTML = html;
        }

        async function generateStrategy() {
            const business = businessInput.value.trim();
            const goal = goalInput.value.trim();
            const userQuery = `Business: ${business}. Goal: ${goal}`;

            if (!business || !goal) {
                responseOutput.innerHTML = '<div class="text-red-500 font-medium p-4">Please fill in both the business type and the goal.</div>';
                return;
            }

            if (API_PROXY_URL === "YOUR_CLOUDFLARE_WORKER_URL_HERE") {
                responseOutput.innerHTML = '<div class="text-red-500 font-medium p-4">ERROR: Please update the \'API_PROXY_URL\' in the script to your deployed worker endpoint.</div>';
                return;
            }

            responseOutput.innerHTML = '';
            loadingIndicator.classList.remove('hidden');
            submitButton.disabled = true;

            // --- 1. AI Persona (System Instruction) ---
            const systemPrompt = `You are 'Silver Ant Marketing Strategy AI,' an elite consultant specializing in small to medium-sized local service businesses. Analyze the user's business and goal and provide a structured, prioritized list of the top 3 tactical recommendations. Your tone must be concise, expert, and actionable, focusing on maximizing local search visibility and converting high-intent local traffic. Never use the word 'template' or 'general.'`;
            
            // --- 2. AI Structured Output (JSON Schema) ---
            const responseSchema = {
                type: "ARRAY",
                description: "A list of the top 3 strategy recommendations.",
                items: {
                    type: "OBJECT",
                    properties: {
                        "rank": { "type": "NUMBER", "description": "The priority rank (1, 2, or 3, where 1 is highest priority)." },
                        "title": { "type": "STRING", "description": "A short, actionable title for the recommendation, e.g., 'Optimize Google Business Profile.'" },
                        "rationale": { "type": "STRING", "description": "A concise, 1-2 sentence justification tailored to the user's specific business and goal." }
                    },
                    required: ["rank", "title", "rationale"]
                }
            };

            const payload = {
                contents: [{ parts: [{ text: userQuery }] }],
                systemInstruction: { parts: [{ text: systemPrompt }] },
                generationConfig: {
                    responseMimeType: "application/json",
                    responseSchema: responseSchema
                }
            };
            
            try {
                const response = await fetch(API_PROXY_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    throw new Error(`Proxy error: ${response.status} ${response.statusText}`);
                }

                const result = await response.json();
                
                // The JSON response is inside candidate.content.parts[0].text
                const jsonText = result.candidates?.[0]?.content?.parts?.[0]?.text;

                if (jsonText) {
                    try {
                        const recommendations = JSON.parse(jsonText);
                        renderRecommendations(recommendations);
                    } catch (e) {
                        responseOutput.innerHTML = `<div class="text-red-500 p-4">AI returned an invalid JSON structure. Raw response: ${jsonText}</div>`;
                        console.error("JSON parsing error:", e, jsonText);
                    }
                } else {
                    responseOutput.innerHTML = '<div class="text-red-500 p-4">Could not generate strategy. Check worker logs for details.</div>';
                }

            } catch (error) {
                console.error("Strategy generation failed:", error);
                responseOutput.innerHTML = `<div class="text-red-500 p-4">An error occurred: ${error.message}. Ensure your Worker URL is correct.</div>`;
            } finally {
                loadingIndicator.classList.add('hidden');
                submitButton.disabled = false;
            }
        }
    </script>
</body>
</html>
